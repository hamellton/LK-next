import React from "react";
import Modal from "../Modal";
import { BackdropContainer, CloseButton, Container, DiscountContainer, ErrorIndicator, InputContainer, InputField, MobileContainerPhoneCapture, PhoneCode, TermAndPP, UnlockButton, UnlockOfferContainer } from "./PhoneCaptureModal.styles";
import { PhoneCaptureModalType } from "./PhoneCaptureModal.types";
import Spinner from "../Spinner";
import { getNumberLengthFromCode } from "../../../helpers";
import { DeviceTypes } from "../../../Types/general";

const PhoneCaptureModal = ({ isLoading,countryCode="",handleShopNow, offerUnlocked,deviceType,value="",dataLocale,showModal,handleSubmit,onInputChange,closeModal,isInvalidNumber,dialogCss }:PhoneCaptureModalType) => {

	if (!dataLocale.isEnable) return null;

	const PhoneCaptureHelper = (event: any) => {
		const keyCode = event.which || event.keyCode;
		const char = String.fromCharCode(keyCode);
		const isDigit = /^\d$/.test(char);

		if (!isDigit) {
			event.preventDefault();
		}

	};

	return deviceType === DeviceTypes.DESKTOP ? (
		<Modal
			show={showModal}
			onHide={() => null}
			keyboard
			dialogCss={dialogCss}
		>
			{isLoading?<Spinner show={isLoading} padding="19% 0"/>:<><CloseButton
				onClick={closeModal}
				deviceType={deviceType}
				role="button"
				tabIndex={-1}
			>
				<div className="left"></div>
				<div className="right"></div>
			</CloseButton><Container deviceType={deviceType}>
				<DiscountContainer deviceType={deviceType}>
					{offerUnlocked ? dataLocale.OFFER_UNLOCKED : dataLocale.OFF_25_PERCENT}
				</DiscountContainer>
				<DiscountContainer deviceType={deviceType} offerUnlocked={offerUnlocked}>{offerUnlocked ? dataLocale.USE_CODE_S25 : dataLocale.FIRST_PAIR_GLASSES}</DiscountContainer>
				{!offerUnlocked && <InputContainer deviceType={deviceType}>
					<PhoneCode deviceType={deviceType}>{countryCode}</PhoneCode>
					<InputField
						deviceType={deviceType}
						autoComplete="phone"
						error={false}
						disabled={false}
						isRTL={false}
						value={value}
						onKeyPress={(event: any) => {
							PhoneCaptureHelper(event);
						}}
						onChange={onInputChange}
						type="tel"
						width="100%"
						placeholder={dataLocale.ENTER_MOBILE_NUMBER}
						maxLength={getNumberLengthFromCode(countryCode)}
					/>
				</InputContainer>}
				{isInvalidNumber && !offerUnlocked && <ErrorIndicator deviceType={deviceType}>{isInvalidNumber}</ErrorIndicator>}
				<UnlockButton disabled={value.length !== getNumberLengthFromCode(countryCode)} deviceType={deviceType} onClick={offerUnlocked ? handleShopNow : handleSubmit}>{offerUnlocked ? dataLocale.SHOP_NOW : dataLocale.UNLOCK_OFFER}</UnlockButton>
			</Container><TermAndPP deviceType={deviceType}>{dataLocale.TERM_CONDITION}</TermAndPP></>}
		</Modal>
	) : (showModal &&
		<>
			<BackdropContainer />
			<MobileContainerPhoneCapture>
				{isLoading?<Spinner show={isLoading} padding="25% 0" />: <><CloseButton deviceType={deviceType} onClick={closeModal} role="button" tabIndex={-1}>
					<div className="left"></div>
					<div className="right"></div>
				</CloseButton><Container deviceType={deviceType}>
					{offerUnlocked ?
						<UnlockOfferContainer>
							<DiscountContainer deviceType={deviceType} offerUnlocked={offerUnlocked}>
								{offerUnlocked ? dataLocale.OFFER_UNLOCKED : dataLocale.OFF_25_PERCENT}
							</DiscountContainer>
							<DiscountContainer deviceType={deviceType} offerUnlocked={offerUnlocked}>
								{offerUnlocked ? dataLocale.USE_CODE_S25 : dataLocale.FIRST_PAIR_GLASSES}
							</DiscountContainer>
						</UnlockOfferContainer>
						: <DiscountContainer deviceType={deviceType}>
							{dataLocale.OFF_25_PERCENT} {dataLocale.FIRST_PAIR_GLASSES}
						</DiscountContainer>}
					{!offerUnlocked && <InputContainer deviceType={deviceType}>
						<PhoneCode deviceType={deviceType}>{countryCode}</PhoneCode>
						<InputField
							deviceType={deviceType}
							autoComplete="phone"
							error={false}
							disabled={false}
							isRTL={false}
							type="tel"
							width="100%"
							placeholder={dataLocale.ENTER_MOBILE_NUMBER}
							maxLength={getNumberLengthFromCode(countryCode)}
							value={value}
							onKeyPress={(event: any) => {
								PhoneCaptureHelper(event);
							}}
							onChange={onInputChange} />
					</InputContainer>}
					{isInvalidNumber && !offerUnlocked && <ErrorIndicator deviceType={deviceType}>{isInvalidNumber}</ErrorIndicator>}
					<UnlockButton deviceType={deviceType} disabled={value.length !== getNumberLengthFromCode(countryCode)} onClick={offerUnlocked ? handleShopNow : handleSubmit}>
						{offerUnlocked ? dataLocale.SHOP_NOW : dataLocale.UNLOCK_OFFER}
					</UnlockButton>
				</Container><TermAndPP deviceType={deviceType}>{dataLocale.TERM_CONDITION}</TermAndPP></>}
			</MobileContainerPhoneCapture></>
	);
};

export default PhoneCaptureModal;
