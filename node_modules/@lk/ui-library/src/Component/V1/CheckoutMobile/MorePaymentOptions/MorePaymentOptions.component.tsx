import React, { useEffect, useState } from "react";
import BottomSheet from "../../../Common/BottomSheet/BottomSheet.component";
import { DottedLine } from "../Cards/Cards.styles";
import CommonSection from "./Common/CommonSection.component";
import { MorePayOptions, NetBankingSection, BackArrow, SectionHeader, NetBankingHeader, SectionHelp, PopularBanks, NetBankingContent, AllBanks, Banks, BanksSection, NetBankingHeaderOuter, InputWrapper, SearchIcon, CrossIcon, NoRelatedBanks, Img } from "./MorePaymentOptions.styles";
import { MorePaymentOptionsTypes } from "./MorePaymentOptions.types";
import { FormInput } from "./Input/Input.component";
import { TypographyENUM } from "../../../../Types/general";

export default function MorePaymentOptions({ popularBanks, allBanks, dataLocale, getSubmitFunction, methodData, abandonedLeadsFunction }:MorePaymentOptionsTypes){
	const [openNetBanking,setOpenNetBanking] = useState(false);
	const [search,setSearch] = useState("");

	const [clearInput,setClearInput] = useState(false);

	function clearSearch(){
		setSearch("");
		setClearInput(true);
	}

	useEffect(()=> {
		clearInput === true && setSearch("");
	},[clearInput]);

	function onClickHandler(){
		setOpenNetBanking(!openNetBanking);
		clearSearch();
	}

	function func(e:string){
		setSearch(e);
	}

	const filteredData = allBanks.filter((itm)=>{
		return search.toLowerCase() === "" ? itm : itm.name.toLowerCase().includes(search.toLowerCase());
	});

	return <MorePayOptions>
		<div onClick={()=>{
			setOpenNetBanking(!openNetBanking);
			abandonedLeadsFunction();
		}}>
			<CommonSection src="https://static.lenskart.com/media/desktop/img/DesignStudioIcons/PaymentMethodIcon.svg" name={dataLocale?.NETBANKING} content={dataLocale?.BANKS_SUPPORTED}></CommonSection>
		</div>

		<BottomSheet showCrossIcon={false} closebottomSheet={onClickHandler} show={openNetBanking} top="0" borderRadius="0" padding="15px 0px" style={{ zIndex:"9999" }}>
			<NetBankingSection>
				<NetBankingHeaderOuter>
					<NetBankingHeader>
						<BackArrow onClick={onClickHandler}>
							<svg width="16" height="12" viewBox="0 0 16 12" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M14.6693 6H1.33594M1.33594 6L6.33594 11M1.33594 6L6.33594 1" stroke="#000042" strokeLinecap="square"/>
							</svg>
						</BackArrow>
						<SectionHeader>
							{dataLocale?.SELECT_BANK}
						</SectionHeader>
						<SectionHelp onClick={()=> window.open(`${dataLocale?.WHATSAPP_CHAT_URL}${dataLocale?.NET_BANKING_HELP_MSG}`,"_self")}><Img
							src="https://static1.lenskart.com/media/desktop/img/DesignStudioIcons/WhatsappIcon.svg"
							alt="phone number"
						/>{dataLocale?.NEED_HELP}?</SectionHelp>
					</NetBankingHeader>

					{/* <FloatingLabelInput hasError={false} label="Search for a Bank" width="100%" font={TypographyENUM.lkSansRegular} type="text" getInputValue={((e)=>func(e))}></FloatingLabelInput> */}

					<InputWrapper>
						<FormInput placeholder={dataLocale?.SEARCH_FOR_A_BANK} type="text" width="100%" font={TypographyENUM.lkSansRegular} getInputValue={((e)=>func(e))} clearInput={clearInput} setClearInput={setClearInput}></FormInput>
						<SearchIcon>
							<svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M19 19L13.0001 13M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8Z" stroke="#737397" strokeWidth="1.5" strokeLinecap="square"/>
							</svg>
						</SearchIcon>

						<CrossIcon onClick={clearSearch}>
							<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M14 8L8 14M8 8L14 14M21 11C21 16.5228 16.5228 21 11 21C5.47715 21 1 16.5228 1 11C1 5.47715 5.47715 1 11 1C16.5228 1 21 5.47715 21 11Z" stroke="#737397" strokeWidth="1.5" strokeLinecap="square"/>
							</svg>
						</CrossIcon>
					</InputWrapper>
				</NetBankingHeaderOuter>
				<NetBankingContent>
					{search==="" && <><div>{dataLocale?.POPULAR_BANKS}</div><PopularBanks>
						<ul>
							{popularBanks.map((item, idx) => {
								return(
									<li key={idx} onClick={()=>getSubmitFunction(methodData.key)(methodData.code,item.bankcode)}>
										<i>
											<img src={item?.logoImageUrl} alt="bank photo" />
										</i>
										<span>
											{item.name}
										</span>
									</li>
								);})}
						</ul>
					</PopularBanks></>}
					{filteredData.length !== 0 && <AllBanks>
						<div>{dataLocale?.ALL_BANKS}</div>
						<Banks>
							{filteredData.map((item,idx)=>(
								<div key={idx} onClick={()=>getSubmitFunction(methodData.key)(methodData.code,item.bankcode)}>
									<BanksSection>
										<img src={item?.logoImageUrl} alt="bank image" />
										<span>{item.name}</span>
										<img
											alt="right arrow"
											src="https://static1.lenskart.com/media/desktop/img/DesignStudioIcons/RightArrow.svg"
										/>
									</BanksSection>
									{filteredData.length - 1 !== idx && <DottedLine></DottedLine>}
								</div>
							))}
						</Banks>
					</AllBanks>}
				</NetBankingContent>

				{filteredData.length === 0 && <NoRelatedBanks>No related bank found</NoRelatedBanks>}
			</NetBankingSection>
		</BottomSheet>
	</MorePayOptions>;
}
