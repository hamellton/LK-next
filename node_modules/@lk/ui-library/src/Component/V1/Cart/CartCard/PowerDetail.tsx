/* eslint-disable no-mixed-spaces-and-tabs */
import React, { useState, useEffect } from "react";
import PowerGrid from "./PowerGrid";

const PowerDetails = (props: any) => {
	const {
		prescription,
		showPowerDetailsFn,
		redisCommonData,
		dataLocale,
		mobileView
	} = props;
	const [powerState, setPowerState] = useState({});
	const [pdState, setPdState] = useState("");
	console.log(pdState);
	const imageFileName = prescription?.imageFileName;
	const left = prescription?.left;
	const right = prescription?.right;
	const pdImageFileName = prescription?.pdImageFileName;
	useEffect(() => {
		let section = "CONTACT_FOR_POWER";
		let icon;
		let message;
		if (imageFileName) {
			section = "POWER_UPLOAD";
		}
		else if (
			left &&
      Object.keys(left).length > 0 &&
      Object.keys(left).some(
      	itm => itm !== "boxes" && left[itm] !== "" && left[itm] !== null && !isNaN(left[itm])
      )
		) {
			section = "POWER_GRID";
		} else if (
			right &&
      Object.keys(right).length > 0 &&
      Object.keys(right).some(
      	itm => itm !== "boxes" && right[itm] !== "" && right[itm] !== null && !isNaN(right[itm])
      )
		) {
			section = "POWER_GRID";
		} else if (
			left &&
      Object.keys(left).length > 0 &&
      "ap" in left &&
      left.ap !== "Call Me/Email Me for Power"
		) {
			section = "POWER_GRID";
		} else if (
			right &&
      Object.keys(right).length > 0 &&
      "ap" in right &&
      right.ap !== "Call Me/Email Me for Power"
		) {
			section = "POWER_GRID";
		}
		if (typeof showPowerDetailsFn === "function") showPowerDetailsFn(section);
		if (["POWER_UPLOAD", "CONTACT_FOR_POWER"].includes(section) || imageFileName) {
			const powerStatusMessage = redisCommonData?.POWER_STATUS_MESSAGE && JSON.parse(redisCommonData.POWER_STATUS_MESSAGE);
			if (section === "POWER_UPLOAD" || imageFileName) {
			  icon = powerStatusMessage?.powerUploadText.icon || "https://static.lenskart.com/media/mobile/universal/assets/power-upload.svg";
			  message =
				powerStatusMessage?.powerUploadText.message ||
				dataLocale?.PRESCRIPTION_UPLOADED_WILL_ASSIST_YOU;
			} else {
			  icon =
				powerStatusMessage?.dontKnowPowerText.icon ||
				"https://static.lenskart.com/media/mobile/universal/assets/dont-know-power1.svg";
			  message =
				powerStatusMessage?.dontKnowPowerText.message ||
				dataLocale?.DONT_KNOW_PRESCRIPTION_WILL_ASSIST_YOU;
			}
		}
		setPowerState({ section: section, icon, message });
		let PdSection = "";
		if ((imageFileName && pdImageFileName) || pdImageFileName) {
			PdSection = "SHOW_POWER_PD";
		} else if (imageFileName && !pdImageFileName) {
			PdSection = "SHOW_POWER";
		}
		setPdState(PdSection);
	}, [prescription, imageFileName, left, right]);
	
	return (
		<PowerGrid mobileView={mobileView} powerState={powerState} handleOpenPrescriptionImageModal={props.handleOpenPrescriptionImageModal} dataLocale={dataLocale} prescription={prescription}/>
	);
};

export default PowerDetails;
